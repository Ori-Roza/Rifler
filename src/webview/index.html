<!-- Rifler Webview Body -->
<!-- Redesigned UI for Issue #83 - Modern search interface -->

<div class="loading-overlay" id="loading-overlay">
  <div class="spinner"></div>
</div>

<!-- Search Input Section -->
<section class="search-section">
  <div class="search-box">
    <div class="search-input-group">
      <button type="button" class="search-history-btn" id="search-history-btn" title="Search history" aria-label="Search history">
        <span class="material-symbols-outlined search-icon" aria-hidden="true">search</span>
        <span class="material-symbols-outlined search-history-caret" aria-hidden="true">arrow_drop_down</span>
      </button>
      <textarea id="query" class="search-input" placeholder="Search..." rows="1" spellcheck="false" autofocus></textarea>
      <div class="search-history-menu" id="search-history-menu"></div>
      <div id="query-validation-message" class="validation-message"></div>
      <div class="search-options">
        <button type="button" class="option-btn" id="match-case" title="Match Case (Alt+C)" data-option="case">
          <span class="material-symbols-outlined">format_size</span>
        </button>
        <button type="button" class="option-btn" id="whole-word" title="Match Whole Word (Alt+W)" data-option="word">
          <span class="material-symbols-outlined">match_word</span>
        </button>
        <button type="button" class="option-btn" id="use-regex" title="Use Regular Expression (Alt+R)" data-option="regex">
          <span class="material-symbols-outlined">regular_expression</span>
        </button>
        <div class="search-overflow" id="search-overflow"></div>
      </div>
    </div>
    <div class="search-controls">
      <button class="icon-btn" id="replace-toggle-btn" title="Toggle Replace (Alt+Shift+F)" aria-label="Replace">
        <span class="material-symbols-outlined">swap_horiz</span>
      </button>
      <button class="icon-btn" id="filter-btn" title="Toggle Filters">
        <span class="material-symbols-outlined filled">tune</span>
      </button>
      <button class="icon-btn" id="clear-search-btn" title="Clear Search (Ctrl+L)" aria-label="Clear Search">
        <span class="material-symbols-outlined">clear</span>
      </button>
      <button class="icon-btn more-actions-btn" id="more-actions-btn" title="More actions" aria-label="More actions">
        <span class="material-symbols-outlined">arrow_drop_down</span>
      </button>
      <div class="more-actions-menu" id="more-actions-menu">
        <button data-action="toggle-replace">
          <span class="material-symbols-outlined">swap_horiz</span>
          <span>Toggle Replace</span>
        </button>
        <button data-action="toggle-filters">
          <span class="material-symbols-outlined filled">tune</span>
          <span>Toggle Filters</span>
        </button>
        <button data-action="clear-search">
          <span class="material-symbols-outlined">clear</span>
          <span>Clear Search</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Replace Row (hidden by default) -->
  <div class="replace-field-row" id="replace-row">
    <span class="material-symbols-outlined replace-icon">swap_horiz</span>
    <input type="text" id="replace-input" class="replace-input" placeholder="Replace with..." />
    <div class="replace-actions">
      <button id="replace-btn" class="secondary" title="Replace (Enter)">Replace</button>
      <button id="replace-all-btn" class="secondary" title="Replace All (Cmd+Enter)">All</button>
    </div>
  </div>

  <!-- Filters Section (Restructured for Issue #83) -->
  <div class="filters-container hidden" id="filters-container">
    <div class="filter-row" id="scope-path-row">
      <div class="filter-field path-field">
        <span class="material-symbols-outlined filter-icon">folder_open</span>
        <div class="filter-input-wrapper">
          <input type="text" id="directory-input" class="path-input" placeholder="src/components/" />
          <div id="directory-validation-message" class="validation-message"></div>
          <select id="module-select" class="path-input" style="display: none;">
            <option value="">Select module...</option>
          </select>
        </div>
      </div>
      <div class="filter-field scope-field">
        <span class="filter-label" id="path-label" style="display: none;">Directory:</span>
        <select id="scope-select" class="scope-dropdown">
          <option value="project">In Project</option>
          <option value="module">Module</option>
          <option value="directory" selected>Directory</option>
        </select>
      </div>
    </div>

    <div class="filter-row" id="file-mask-row">
      <div class="filter-field">
        <span class="material-symbols-outlined filter-icon">filter_alt</span>
        <input type="text" id="file-mask" class="mask-input" placeholder="*.ts, *.js" />
        <label class="smart-exclude-toggle">
          <span class="smart-exclude-label" title="Apply smart excludes for detected project types (e.g. node_modules, target, vendor)">Smart Excludes</span>
          <input type="checkbox" id="smart-exclude-toggle" checked />
        </label>
      </div>
    </div>
  </div>
  <div id="file-mask-validation-message" class="validation-message"></div>
</section>

<!-- Main Content Area -->
<div class="main-content">
  <!-- Results Summary and Actions -->
  <div class="results-summary-bar">
    <span id="results-count-text" class="results-count-text">Type to search...</span>
    <div class="summary-actions">
      <button class="collapse-all-btn" id="collapse-all-btn" style="display: none;">
        Collapse All <span class="material-symbols-outlined">unfold_less</span>
      </button>
    </div>
  </div>

  <!-- Results Panel -->
  <div class="results-panel" id="results-panel">
    <div class="results-list" id="results-list">
      <div class="empty-state">Type to search...</div>
    </div>
  </div>

  <!-- Draggable Preview Panel -->
  <div class="preview-panel-container" id="preview-panel-container">
    <!-- Drag Handle -->
    <div class="drag-handle" id="drag-handle">
      <button class="preview-toggle-btn" id="preview-toggle-btn" title="Toggle Preview Panel (Ctrl+Shift+P)">
        <span class="material-symbols-outlined">close_fullscreen</span>
      </button>
      <div class="drag-handle-bar"></div>
    </div>

    <!-- Preview Panel -->
    <div class="preview-panel" id="preview-panel">
      <div class="preview-header">
        <div class="preview-title-group">
          <span class="seti-icon seti-default" id="file-icon"></span>
          <div class="preview-info">
            <span class="preview-filename" id="preview-filename">Select a result to preview</span>
            <span class="preview-filepath" id="preview-filepath"></span>
          </div>
        </div>
        <div class="preview-actions" id="preview-actions" style="display: none;">
        </div>
      </div>
      
      <div class="preview-body">
        <div class="preview-loading-overlay" id="preview-loading-overlay">
          <div class="spinner"></div>
        </div>
        <div class="preview-content hljs" id="preview-content">
          <div class="empty-state">Select a result to preview file</div>
        </div>
        
        <div class="editor-container" id="editor-container">
          <div class="editor-wrapper">
            <div class="editor-line-numbers" id="editor-line-numbers"></div>
            <div class="editor-content-wrapper">
              <div id="editor-backdrop" class="hljs"></div>
              <textarea id="file-editor" spellcheck="false"></textarea>
            </div>
          </div>
          <div id="replace-widget" class="replace-widget">
            <div class="replace-widget-main-row">
              <input type="text" id="local-search-input" placeholder="Search">
              <span id="local-sep-after-search" class="local-divider" aria-hidden="true"></span>

              <div id="local-replace-row" class="local-replace-inline" hidden>
                <input type="text" id="local-replace-input" placeholder="Replace">
                <span class="local-divider" aria-hidden="true"></span>
              </div>

              <span class="replace-match-count" id="local-match-count"></span>

              <span class="local-divider" aria-hidden="true"></span>

              <div class="local-replace-buttons" id="local-replace-buttons" hidden>
                <button id="local-replace-btn" class="secondary" title="Replace (Enter)">Replace</button>
                <button id="local-replace-all-btn" class="secondary" title="Replace All (Cmd+Enter)">Replace All</button>
              </div>

              <div class="local-controls">
                <button id="local-prev-btn" class="ghost" title="Previous match (Shift+Enter)">
                  <span class="material-symbols-outlined">arrow_upward</span>
                </button>
                <button id="local-next-btn" class="ghost" title="Next match (Enter)">
                  <span class="material-symbols-outlined">arrow_downward</span>
                </button>
                <button id="local-replace-close" class="ghost" title="Close (Esc)">
                  <span class="material-symbols-outlined">close</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
